<!-- Copyright 2023

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License. -->

{% extends "base.html" %}
{% block app_content %}
<br>
<div class='row'>
    <div class="col-lg-3" style="padding-left: 30px;">
        <div class="card" style='min-height:400px' id="filterCard">
            <div class='card-header' style="margin-top: 0px; margin-bottom: 0px; border-bottom: 1px solid rgb(60,74,89); ">
                <h3>Generate Analysis</h3>
            </div>
            <div class="tab">
                <button id='openAnalysisTab' class="tablinks" onclick="openAnalysisEdit(event, 'baseAnalysisDiv')">Analysis Options</button>
                <button id='openChartTab'class="tablinks" onclick="openAnalysisEdit(event, 'baseChartDiv')">Chart Options</button>
                <button id="openTasksTab" class="tablinks" onclick="openAnalysisEdit(event, 'baseTasksDiv')">Task Selection</button>
            </div>

            <div class="card-body" id="filterCardDiv">
                <div id="baseAnalysisDiv" class="tabcontent">
                    <h5 style="margin-bottom: 2px">Analysis</h5>
                    <div style="font-size: 80%; margin-bottom: 2px"><i>Select which analysis you want to apply.</i></div>
                    <div class="row">
                        <div class='col-lg-10'>
                            <select id="analysisSelector" class='form-control'>
                                <option value="-1">None</option>
                                <option value="0" selected>Summary</option>
                                <option value="1">Temporal Analysis</option>
                                <option value="2">Spatial Analysis</option>
                                <option value="3">Numerical Analysis</option>
                                <option value="4">Time Analysis</option>
                                <option value="5">Activity Pattern</option>
                                <option value="6">Occupancy Analysis</option>
                            </select>
                        </div>
                    </div>
                    <br>
                    
                    <div id="chartTypeDiv" hidden>
                        <h5 style="margin-bottom: 2px">Chart</h5>
                        <div style="font-size: 80%; margin-bottom: 2px"><i>Select the chart type you would like to see your results in.</i></div>
                        <div class="row">
                            <div class='col-lg-10'>
                                <select id="chartTypeSelector" class='form-control'>
                                    <option value="line">Line Chart</option>
                                    <option value="bar">Bar Chart</option>
                                    <option value="polarArea">Polar Chart</option>
                                    <option value="scatter">Scatter Chart</option>
                                    <!-- <option value="radar">Radar Chart</option> -->
                                </select>
                            </div>
                        </div>
                        <br>
                    </div>

                    <h5 style="margin-bottom: 2px">Data Unit</h5>
                    <div style="font-size: 80%; margin-bottom: 2px"><i>Select which data unit you would like to see results for.</i></div>
                    <div class="row">
                        <div class='col-lg-10'>
                            <select id="baseUnitSelector" class='form-control'>
                                <option value="2">Clusters</option>
                                <option value="3">Sightings</option>
                                <option value="1">Images</option>
                            </select>
                        </div>
                    </div>
                    <br>

                    <h5 style="margin-bottom: 2px">Date range</h5>
                    <div style="font-size: 80%; margin-bottom: 2px"><i>Select the date range you would like to see results for.</i></div>
                    <div class="row">
                        <div class='col-lg-5'>
                            <label for="startDate">Start date:</label><br>
                            <input type="date" id="startDate" name="startDate">
                        </div>
                        <div class='col-lg-5'>
                            <label for="endDate">End date:</label><br>
                            <input type="date" id="endDate" name="endDate">
                        </div>
                    </div>
                    <div id="dateErrors" style="font-size: 80%; color: #DF691A"></div>
                
                    <br>
                    <!-- <button class="btn btn-primary" id="btnManageAnnotationSets">Manage Annotation Sets</button>
                    <br>
                    <br>	 -->

                    <div id="cameraTrapDiv" hidden>
                        <h5 style="margin-bottom: 2px">Camera Trap</h5>
                        <div style="font-size: 80%; margin-bottom: 2px"><i>Please select whether you want to evaluate by site or by camera for the camera trap summaryresults.</i></div>
                        <div class="row">
                            <div class='col-lg-10'>
                                <select id="cameraSelector" class='form-control'>
                                    <option value="0">Site</option>
                                    <option value="1">Camera</option>
                                </select>
                            </div>
                        </div>
                        <br>
                    </div>

                    <div id="observationWindowDiv" hidden>
                        <h5 style="margin-bottom: 2px">Observation Window</h5>
                        <div style="font-size: 80%; margin-bottom: 2px"><i>Enter the observation window in days for the analysis.</i></div>
                        <div class="row">
                            <div class='col-lg-10'>
                                <input type="number" class="form-control" id="observationWindow" value="1" min="1" step="1" default="1"></input>
                            </div>
                        </div>
                        <br>
                    </div>

                    <div id="comparisonDiv" hidden>
                        <h5 style="margin-bottom: 2px">Comparison</h5>
                        <div style="font-size: 80%; margin-bottom: 2px">
                        <i>Select what type of comparison you would like to do.</i>
                        </div>
                        <div class="row">
                        <div class="col-lg-10">
                            <select class="form-control" id="xAxisSelector">
                                <option value="1">Survey Counts</option>
                                <option value="2">Site Counts</option>
                                <!-- <option value="3">Group Counts</option> -->
                            </select>
                        </div>
                        </div>
                        <br>
                        <div id="siteCountDiv" hidden>
                            <h5 style="margin-bottom: 2px">Site</h5>
                            <div style="font-size: 80%; margin-bottom: 2px">
                                <i>Select the site you would like to compare.</i>
                            </div>
                            <div id="siteCountSelectorDiv"></div>
                            <button class="btn btn-info" type="button" id="btnAddSiteCount" onclick=buildSiteCountSelectorRow()>+</button>
                            <div id="siteCountErrors" style="font-size: 80%; color: #DF691A"></div>
                            <br>
                        </div>
                    </div>

                    <div id="normalisationDiv" hidden>
                        <h5 style="margin-bottom: 2px">Normalisation</h5>
                        <div style="font-size: 80%; margin-bottom: 2px">
                        <i>Normalise the counts using the total count for each item.</i>
                        </div>
                        <div class="row">
                        <div class="col-lg-10">
                            <select class="form-control" id="normalisationSelector">
                                <option value="1">Raw Count</option>
                                <option value="2">Normalised</option>
                            </select>
                        </div>
                        </div>
                        <br>
                    </div>

                    <div id="timeUnitSelectionDiv" hidden>
                        <h5 style="margin-bottom: 2px">Time Unit</h5>
                        <div style="font-size: 80%; margin-bottom: 2px">
                            <i>Select the time unit you would like to see your results in.</i>
                        </div>
                        <div class="row">
                            <div class="col-lg-4">
                                <input type="number" class="form-control" id="timeUnitNumber" value="1" min="1" step="1">
                            </div>
                            <div class="col-lg-6">
                            <select class="form-control" id="timeUnitSelector">
                                <option value="1">Day</option>
                                <option value="2" selected>Month</option>
                                <option value="3">Year</option>
                            </select>
                            </div>
                            <div id="timeUnitErrors" style="font-size: 80%; color: #DF691A"></div>
                        </div>
                        <br> 
                    </div>

                    <div id="analysisDataDiv" hidden>
                        <h5 style="margin-bottom: 2px">Data</h5>
                        <div style="font-size: 80%; margin-bottom: 2px"><i>Select which site and species combination you would like to see results for.</i></div>
                        <div id="dataDiv"></div>
                        <button class="btn btn-info" type="button" id="btnAddSpeciesAndSite" onclick=buildDataSelectorRow()>+</button>
                        <div id="dataErrors" style="font-size: 80%; color: #DF691A"></div>	
                        <br>
                    </div>

                    <div id="numericalDataDiv" hidden>
                        <h5 style="margin-bottom: 2px">Species</h5>
                        <div style="font-size: 80%; margin-bottom: 2px">
                        <i>Select the species you would like to see results for.</i>
                        </div>
                        <div id="speciesDiv"></div>
                        <button class="btn btn-info" type="button" id="btnAddSpecies" onclick=buildSpeciesSelectorRow()>+</button>
                        <br>
                        <br>
                    </div>

                    <div id="spatialDataDiv" hidden>
                        <h5 style="margin-bottom: 2px">Species</h5>
                        <div style="font-size: 80%; margin-bottom: 2px">
                        <i>Select which species you would like to see results for.</i>
                        </div>
                        <div class="row">
                        <div class="col-lg-10">
                            <select class="form-control" id="speciesSelect"></select>
                        </div>
                        </div>
                        <br>

                        <h5 style="margin-bottom: 2px">Sites</h5>
                        <div style="font-size: 80%; margin-bottom: 2px">
                        <i>Select the sites you would like to see results for.</i>
                        </div>
                        <div id="selectorColumn"></div>
                        <button class="btn btn-info" type="button" id="btnAddSites" onclick=buildSiteSelectorRow()>+</button>
                        <div id="spatialDataErrors" style="font-size: 80%; color: #DF691A"></div>
                        <br>
                    </div>

                    <div id="speciesDataDiv" hidden>
                        <h5 style="margin-bottom: 2px">Species</h5>
                        <div style="font-size: 80%; margin-bottom: 2px">
                        <i>Select the species you would like to see results for.</i>
                        </div>
                        <div id="speciesSelectorDiv"></div>
                        <button class="btn btn-info" type="button" id="btnAddSpecie" onclick=buildRSpeciesRows()>+</button>
                        <br>
                        <br>
                    </div>

                    <div id="siteDataDiv" hidden>
                        <h5 style="margin-bottom: 2px">Site</h5>
                        <div style="font-size: 80%; margin-bottom: 2px">
                            <i>Select the sites you would like to see results for.</i>
                        </div>
                        <div id="siteSelectorDiv"></div>
                        <button class="btn btn-info" type="button" id="btnAddSite" onclick=buildRSiteRows()>+</button>
                        <div id="siteDivErrors" style="font-size: 80%; color: #DF691A"></div>
                        <br>
                    </div>

                    <div id="groupButtonsDiv" hidden>
                        <div class="row">
                            <div class="col-lg-6">
                                <button type='button' class='btn btn-primary btn-block' id='btnViewGroups' onclick=viewGroups()>View Groups</button>  
                            </div>
                            <div class="col-lg-6">
                                <button type='button' class='btn btn-primary btn-block' id='btnSaveGroupFromData' onclick=saveGroupFromData() disabled>Save Group</button>  
                            </div>
                        </div>
                        <br>
                    </div>

                    <div id="covariatesDiv" hidden>
                        <h5 style="margin-bottom: 2px">Covariates</h5>
                        <div style="font-size: 80%; margin-bottom: 2px"><i>Fill in the covariates you would like to see results for.</i></div>
                        <div class="row">
                            <div class="col-lg-12">
                                <button type='button' class='btn btn-primary btn-block' id='btnCreateCovariates' onclick=buildCovariates()>Enter Covariates</button>
                            </div>
                        </div>
                        <br>
                    </div>

                    <div id="optionsDiv" hidden>
                        <h5 style="margin-bottom: 2px">Centre</h5>
                        <div style="font-size: 80%; margin-bottom: 2px">
                        <i>Select whether you would like to centre your plot on midday or midnight.</i>
                        </div>
                        <div class="row">
                        <div class="col-lg-10">
                            <div class="custom-control custom-radio custom-control-inline">
                                <input type="radio" class="custom-control-input" id="centreDay" name="centreActivity" value='1' checked>
                                <label class="custom-control-label" for="centreDay">Day</label>
                            </div>
                            <div class="custom-control custom-radio custom-control-inline">
                                <input type="radio" class="custom-control-input" id="centreNight" name="centreActivity" value='2'>
                                <label class="custom-control-label" for="centreNight">Night</label>
                            </div> 
                        </div>
                        </div>
                        <br>
                        <h5 style="margin-bottom: 2px">Unit</h5>
                        <div style="font-size: 80%; margin-bottom: 2px">
                        <i>Select the unit you would like to see your activity pattern results..</i>
                        </div>
                        <div class="row">
                            <div class="col-lg-10">
                                <div class="custom-control custom-radio custom-control-inline">
                                    <input type="radio" class="custom-control-input" id="unitDensity" name="unitActivity" value='1' checked>
                                    <label class="custom-control-label" for="unitDensity">Density</label>
                                </div>
                                <div class="custom-control custom-radio custom-control-inline">
                                    <input type="radio" class="custom-control-input" id="unitFreq" name="unitActivity" value='2'>
                                    <label class="custom-control-label" for="unitFreq">Frequency</label>
                                </div> 
                            </div>
                        </div>
                        <br>
                        <h5 style="margin-bottom: 2px">Time</h5>
                        <div style="font-size: 80%; margin-bottom: 2px">
                        <i>Select how you would like to format your time.</i>
                        </div>
                        <div class="row">
                            <div class="col-lg-10">
                                <div class="custom-control custom-radio custom-control-inline">
                                    <input type="radio" class="custom-control-input" id="clockTime" name="timeActivity" value='1' checked>
                                    <label class="custom-control-label" for="clockTime">Clock Time</label>
                                </div>
                                <div class="custom-control custom-radio custom-control-inline">
                                    <input type="radio" class="custom-control-input" id="solarTime" name="timeActivity" value='2'>
                                    <label class="custom-control-label" for="solarTime">Solar Time</label>
                                </div> 
                                <div id=solarDiv hidden>
                                    <label for="coordinates">Coordinates:</label>
                                    <input type="text" id="coordinates" name="coordinates" class="form-control" placeholder="e.g., 51.5074, 0.1278">

                                    <label for="timezone">Timezone:</label>
                                    <input type="text" id="timezone" name="timezone" class="form-control"  placeholder="e.g., UTC+01:00">
                                </div>
                            </div>
                        </div>
                        <br>
                        <h5 style="margin-bottom: 2px">Overlap</h5>
                        <div style="font-size: 80%; margin-bottom: 2px">
                        <i>Select whether you would like to applay overlap estimation for two species.</i>
                        </div>
                        <div class="row">
                            <div class="col-lg-10">
                                <div class="custom-control custom-checkbox">
                                    <input type="checkbox" class="custom-control-input" id="overlapEst" name="overlapEst">
                                    <label class="custom-control-label" for="overlapEst">Show Overlap Estimation</label>
                                </div>
                            </div>
                        </div>
                        <br>
                    </div>

                    <div id="buttonsR" hidden>
                        <div class="row">
                            <div class="col-lg-12">
                                <button type='button' class='btn btn-primary btn-block' id='btnRunScript' onclick="updateResults(true)">Generate Results</button>
                            </div>
                        </div>
                        <br>
                        <div class="row">
                            <div class="col-lg-6">
                                <button type='button' class='btn btn-primary btn-block' id='btnViewScript'>View R Script</button>
                            </div>
                            <div class="col-lg-6">
                                <button type='button' class='btn btn-primary btn-block' id='btnDownloadResultsCSV'>Download CSV</button>
                            </div>
                        </div>
                        <div id="rErrors" style="font-size: 80%; color: #DF691A"></div>
                        <br>
                    </div>

                    <div id="trendlineDiv" hidden>
                        <h5 style="margin-bottom: 2px">Trendline</h5>
                        <div style="font-size: 80%; margin-bottom: 2px">
                            <i>Select the type of trendline you would like to see.</i>
                        </div>
                        <div class="row">
                            <div class="col-lg-10">
                            <select class="form-control" id="trendlineSelector">
                                <option value="-1">None</option>
                                <option value="linear">Linear</option>
                                <option value="polynomial">Polynomial</option>
                                <option value="exponential">Exponential</option>
                                <option value="logarithmic">Logarithmic</option>
                                <option value="power">Power</option>
                            </select>
                            </div>
                        </div>
                        <div id="trendlineOrderDiv" hidden>
                            <div class="row">
                                <div class="col-lg-2" style="display: flex; align-items: center;">
                                    <label for="trendlineOrder">Order:</label>
                                </div>
                                <div class="col-lg-3">
                                    <input type="number" class="form-control" id="trendlineOrder" value="2" min="1" max="10" step="1">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-10">
                                <div class="custom-control custom-checkbox">
                                    <input type="checkbox" class="custom-control-input" id="trendlineOnlyCheckbox" name="trendlineOnlyCheckbox">
                                    <label class="custom-control-label" for="trendlineOnlyCheckbox">Trendline Only</label>
                                </div>
                            </div>
                        </div> 
                        <br>
                    </div>
                    
                    <div id="spatialOptionsDiv" hidden>
                        <h5 style="margin-bottom: 2px">Radius</h5>
                        <div style="font-size: 80%; margin-bottom: 2px">
                            <i>Set the heatmap radius to help identify different trends.</i>
                        </div>
                        <div class="row">
                            <div class="col-lg-10">
                            <div class="row">
                                <div class="col-lg-10" style="padding: 0px" align="center">
                                <div class="justify-content-center">
                                    <div class="w-75">
                                    <input type="range" class="custom-range" id="radiusSlider" min="0" max="100" value="54">
                                    </div>
                                </div>
                                </div>
                                <div class="col-lg-2" style="padding-left: 0px">
                                <div id="radiusSliderspan" align="right" style="font-size: 80%">50</div>
                                </div>
                            </div>
                            </div>
                        </div>
                        <br>
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="markerCheckBox" name="markerCheckBox" checked>
                            <label class="custom-control-label" for="markerCheckBox">Show Sites</label>
                        </div>

                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="normalisationCheckBox" name="normalisationCheckBox">
                            <label class="custom-control-label" for="normalisationCheckBox">Normalise for Site Density</label>
                        </div>

                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="heatMapCheckBox" name="heatMapCheckBox" checked>
                            <label class="custom-control-label" for="heatMapCheckBox">Show Heat Map</label>
                        </div>

                        <div id="extraSpatOptionsDiv"></div>
                    </div>

                </div>

                <div id="baseChartDiv" class="tabcontent">
                    <div id="exportOptionsDiv">
                        <h5 style="margin-bottom: 2px">Background</h5>
                        <div style="font-size: 80%; margin-bottom: 2px"><i>Select the background for your chart.</i></div>
                        <div class="row">
                            <div class="col-lg-10">
                                <select id="backgroundSelector" class='form-control' onchange="updateChartStyle()">
                                    <option value="1">Transparent</option>
                                    <option value="2">White</option>
                                    <option value="3">Black</option>
                                    <option value="4">Grey</option>
                                </select>
                            </div>
                        </div>
                        <br>
    
                        <h5 style="margin-bottom: 2px">Text Colour</h5>
                        <div style="font-size: 80%; margin-bottom: 2px"><i>Select the text colour for your chart.</i></div>
                        <div class="row">
                            <div class="col-lg-10">
                                <select id="textColourSelector" class='form-control' onchange="updateChartStyle()">
                                    <option value="white">White</option>
                                    <option value="black">Black</option>
                                </select>
                            </div>
                        </div>
                        <br>
    
                        <h5 style="margin-bottom: 2px">Axis Colour</h5>
                        <div style="font-size: 80%; margin-bottom: 2px"><i>Select the axis colour style for your chart.</i></div>
                        <div class="row">
                            <div class="col-lg-10">
                                <select id="axisColourSelector" class='form-control' onchange="updateChartStyle()">
                                    <option value="1">Light</option>
                                    <option value="2" selected>Dark</option>
                                </select>
                            </div>
                        </div>
                        <br>

                        <h5 style="margin-bottom: 2px">Border Colour</h5>
                        <div style="font-size: 80%; margin-bottom: 2px"><i>Select the border colour for the data on your chart.</i></div>
                        <div class="row">
                            <div class="col-lg-10">
                                <select id="borderColourSelector" class='form-control' onchange="updateChartStyle()">
                                    <option value="white">White</option>
                                    <option value="black">Black</option>
                                </select>
                            </div>
                        </div>
                        <br>
    
                        <h5 style="margin-bottom: 2px">Include</h5>
                        <div style="font-size: 80%; margin-bottom: 2px"><i>Select the elements to be included in your chart.</i></div>
                        <div class="row">
                            <div class="col-lg-10">
                                <div class="custom-control custom-checkbox">
                                    <input type="checkbox" class="custom-control-input" id="includeLegend" onchange="updateChartStyle()" checked>
                                    <label class="custom-control-label" for="includeLegend">Legend</label>
                                </div>
                                <div class="custom-control custom-checkbox">
                                    <input type="checkbox" class="custom-control-input" id="includeLabels" onchange="updateChartStyle()" checked>
                                    <label class="custom-control-label" for="includeLabels">Labels</label>
                                </div>
                                <div class="custom-control custom-checkbox">
                                    <input type="checkbox" class="custom-control-input" id="includeRadialAxisLabels" onchange="updateChartStyle()" checked>
                                    <label class="custom-control-label" for="includeRadialAxisLabels">Radial Axis Labels</label>
                                </div>
                                <div class="custom-control custom-checkbox">
                                    <input type="checkbox" class="custom-control-input" id="includeGridLines" onchange="updateChartStyle()" checked>
                                    <label class="custom-control-label" for="includeGridLines">Grid Lines</label>
                                </div>
                                <div class="custom-control custom-checkbox">
                                    <input type="checkbox" class="custom-control-input" id="includeBorders" onchange="updateChartStyle()" checked>
                                    <label class="custom-control-label" for="includeBorders">Borders</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>       

                <div id="baseTasksDiv" class="tabcontent">
                    <div id="annotationSetDiv">
                        <h5 style="margin-bottom: 2px">Surveys and Annotation Sets</h5>
                        <div style="font-size: 80%; margin-bottom: 2px"><i>Select which annotation set should be used for you results for surveys which have multiple annotation sets.</i></div>
                        <div class="row">
                            <div class="col-lg-6">Surveys</div>
                            <div class="col-lg-6">Annotation Sets</div>
                        </div>
                        <div id="annotationDiv"></div>
                        <div id="annotationSetErrors" style="font-size: 80%; color: #DF691A"></div>
                        <br>

                        <button id="btnSaveSets" type='button' class='btn btn-primary btn-block'>Save</button>

                    </div>
                </div>
            </div>
            <div class="card-footer" style="border-top: 1px solid rgb(60,74,89);">
                <div class="row">
                    <div class="col-lg-3"></div>
                    <div class="col-lg-6">
                        <button type='button' class='btn btn-primary btn-block' id='btnClearResults' onclick=clearResults()>Clear</button>  
                    </div>
                    <div class="col-lg-3"></div>
                </div>
            </div>          
        </div>
    </div>
    <div class='col-lg-9' style="padding-right: 30px;">
        <div class="card" style='min-height:400px' id="mainCard">
            <div class='card-header' style="margin-top: 0px; margin-bottom: 0px; border-bottom: 1px solid rgb(60,74,89); ">
            <div class='row' style="margin-top: 0px; margin-bottom: 0px">
                <div class='col-lg-4'>
                    <h3>Your Analysis</h3>
                </div>
            </div>
            </div>
            <div id="resultsTab" class="tab"></div>
            <div class="card-body" id="resultsCard">
                <div id="statisticsErrors" style="color: #DF691A"></div>
                <div id="loadingDiv" style="display: none;">
                    <div class="row">
                        <div class="col-lg-12" style="min-height: 600px; display: flex; align-items: center; justify-content: center;">
                            <div id="loadingCircle" class="loading-circle"></div>
                        </div>
                    </div>
                </div>
                <div id="resultsDiv" ></div>   
                <br>
                <div id="scriptDiv" hidden>
                    <h5 style="margin-bottom: 2px">R Script</h5>
                    <div style="font-size: 80%; margin-bottom: 2px"><i>Copy and paste the R script below into R to generate the results.</i></div>
                    <textarea id="scriptTextArea" class="form-control" rows="20"></textarea>
                </div>
            </div>
    
            <div class="card-footer" style="border-top: 1px solid rgb(60,74,89);">
                <div class="row">
                    <div class="col-lg-5"></div>
                    <div class="col-lg-2">
                        <button type='button' class='btn btn-primary btn-block' id='btnExportResults' onclick=exportResults() disabled>Export</button>  
                    </div>
                    <div class="col-lg-5"></div>
                </div>
            </div>  
        </div>
        <br>
    </div>
</div>

<!-- View Groups Modal -->
<div id="modalViewGroups" class="modal fade" role="dialog" tabindex="-1">
    <div class="modal-dialog" style="max-width: 75%;">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header" style="margin-top: 0px; margin-bottom: 0px; border-bottom: 1px solid rgb(60,74,89);">
                <div class='col-lg-11' style="padding: 0px">
                    <h4 style="margin-bottom: 2px;">Groups</h4>                   
                </div>
                <div class='col-lg-1' style="padding: 0px">
                    <div class="row">
                        <div class='col-lg-6' style="padding: 0px">
                            <button class='btn btn-primary btn-sm pull-right'>Help</button>
                        </div>
                        <div class='col-lg-5' style="padding: 0px">
                            <button id="helpx" type="button" class="close" data-dismiss="modal">&times;</button>
                        </div>
                        <div class='col-lg-1' style="padding: 0px"></div>
                    </div>
                </div>
            </div>
            <div class="modal-body" id="viewGroupsBody" style="padding: 0px;">

                <div id="groupsDiv"></div>
                
            </div>
            <div class="modal-footer">
                <div class="col-lg-8"></div>
                <div class="col-lg-2">
                    <button type='button' class='btn btn-primary btn-block' id='btnCreateGroup'>Create Group</button>
                </div>
                <div class="col-lg-2">
                    <button type='button' class='btn btn-info btn-block' id='btnCloseViewGroups' data-dismiss="modal">Close</button>  
                </div>
            </div>
        </div>    
    </div>
</div>

<!-- Groups Modal -->
<div id="modalGroups" class="modal fade" role="dialog" tabindex="-1">
    <div class="modal-dialog" style="max-width: 50%;">
  
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                  <div class='col-lg-11' style="padding: 0px">
                      <h4 id= 'groupHeader' style="margin-bottom: 2px;"></h4>                   
                  </div>
                <div class='col-lg-1' style="padding: 0px">
                    <div class="row">
                        <div class='col-lg-6' style="padding: 0px">
                            <button class='btn btn-primary btn-sm pull-right'>Help</button>
                        </div>
                        <div class='col-lg-5' style="padding: 0px">
                            <button id="helpx" type="button" class="close" data-dismiss="modal">&times;</button>
                        </div>
                        <div class='col-lg-1' style="padding: 0px"></div>
                    </div>
                </div>
            </div>
            <div class="modal-body">
                <div id="createGroupsDiv">
                    <h5 style="margin-bottom: 2px">Name</h5>
                    <div style="font-size: 80%; margin-bottom: 2px"><i>A unique identifying name for your group.</i></div>
                    <div class="row">
                        <div class='col-lg-6'>
                            <input type="text" class="form-control" id="groupName"></input>
                        </div>
                    </div>
                    <br>

                    <h5 style="margin-bottom: 2px">Description</h5>
                    <div style="font-size: 80%; margin-bottom: 2px"><i>Any additional information associated with your group.</i></div>
                    <div class="row">
                        <div class='col-lg-6'>
                            <textarea class="form-control" id="groupDescription" rows="2"></textarea>
                        </div>
                    </div>
                    <br>

                    <h5 style="margin-bottom: 2px"> Add Sites</h5>
                    <div style="font-size: 80%; margin-bottom: 2px"><i>Select the sites you would like to add to your group. Search the sites by name or select the sites on the map. </i></div>
                    <div class="row">
                        <div class='col-lg-6'>
                            <div class="custom-control custom-radio custom-control-inline">
                                <input type="radio" class="custom-control-input" id="searchSitesRb" name="addSitesMethod" value='1' checked>
                                <label class="custom-control-label" for="searchSitesRb">Search sites</label>
                            </div>
                            <div class="custom-control custom-radio custom-control-inline">
                                <input type="radio" class="custom-control-input" id="selectSitesRb" name="addSitesMethod" value='2'>
                                <label class="custom-control-label" for="selectSitesRb">Select sites on map</label>
                            </div> 
                        </div>
                    </div>
                    <br>
                    <div id='addSitesDiv'></div>
                    <br>

                    <h5 style="margin-bottom: 2px"> Sites</h5>
                    <div style="font-size: 80%; margin-bottom: 2px"><i>View the sites you have added to your group. </i></div>
                    <div id="groupSitesDiv"></div>
                    <br>

                    <div id="groupErrors" style="font-size: 80%; color: #DF691A"></div>
                </div>
            </div>
            <div class='modal-footer'>
                <div class='col-lg-2'>
                    <button id="btnSaveGroup" type='button' class='btn btn-primary btn-block'>Save</button>
                </div>
                <div class='col-lg-2'>
                    <button id="groupsClose" type='button' class='btn btn-info btn-block' 
                    data-dismiss='modal'>Close</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Sites Modal -->
<div id="modalSitesMap" class="modal fade" role="dialog" tabindex="-1">
    <div class="modal-dialog" style="max-width: 80%; min-height: 700px">
    <!-- Modal content-->
    <div class="modal-content">
        <div class="modal-header">
            <div class='col-lg-11' style="padding: 0px">
                <h4 style="margin-bottom: 2px;">Site Map</h4>                   
            </div>
            <div class='col-lg-1' style="padding: 0px">
                <div class="row">
                    <div class='col-lg-6' style="padding: 0px">
                        <button class='btn btn-primary btn-sm pull-right'>Help</button>
                    </div>
                    <div class='col-lg-5' style="padding: 0px">
                        <button id="helpx" type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <div class='col-lg-1' style="padding: 0px"></div>
                </div>
            </div>
        </div>
        <div class="modal-body">
            <div id="drawSitesDiv">
                <h5 style="margin-bottom: 2px">Instruction</h5>
                <div style="font-size: 80%; margin-bottom: 2px"><i>Draw an area around the sites on the map which you want to include in your group. </i></div>
                <div id="mapSiteErrors" style="font-size: 80%; color: #DF691A"></div>
                <br>
                <div id="mapSitesDiv" style="min-height: 400px;"></div>
            </div>
        </div>   
        <div class='modal-footer'>
            <div class='col-lg-2'>
                <button id="btnSaveSitesOnMap" type='button' class='btn btn-primary btn-block'>Save</button>
            </div>
            <div class='col-lg-2'>
                <button id="groupsClose" type='button' class='btn btn-info btn-block' 
                data-dismiss='modal'>Close</button>
            </div>

        </div>
    </div>
    </div>
</div>

<!-- Delete Group Confirmation Modal -->
<div id="modalConfirmDelete" class="modal fade" role="dialog" tabindex="-1">
    <div class="modal-dialog">
  
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <h4 id='modalConfirmHeader' class="modal-title">Confirmation Required</h4>
                <button id="helpx" type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <p id='modalConfirmBody' align="justify"></p>
            </div>
            <div class='modal-footer'>
                <div class='col-lg-3'>
                    <button id="btnConfirmDelete" type='button' class='btn btn-danger btn-block' 
                    data-dismiss='modal'>Confirm</button>
                </div>
                <div class='col-lg-3'>
                    <button id="confirmclose" type='button' class='btn btn-info btn-block' 
                    data-dismiss='modal'>Close</button>
                </div>

            </div>
        </div>
  
    </div>
</div>

<!--Export Alert modal-->
<div id="modalExportAlert" class="modal fade" role="dialog" tabindex="-1">
    <div class="modal-dialog">
  
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <h4 id='modalConfirmHeader' class="modal-title">Export</h4>
                <button id="helpx" type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <p id='modalConfirmBody' align="justify">Spatial Analysis can only be exported if your map selection is from OpenStreetMaps. Please select an OpenStreetMaps map and try again.</p>
            </div>
            <div class='modal-footer'>
                <div class='col-lg-3'>
                    <button id="confirmclose" type='button' class='btn btn-info btn-block' 
                    data-dismiss='modal'>Close</button>
                </div>

            </div>
        </div>
  
    </div>
</div>

<!-- Covariates Modal -->
<div id="modalCovariates" class="modal fade" role="dialog" tabindex="-1" style="overflow-y: auto;">
    <div class="modal-dialog" style="max-width: 80%;">
        <div class="modal-content">
            <div class="modal-header">
                <div class='col-lg-11' style="padding: 0px">
                    <h4 id= 'covariatesHeader' style="margin-bottom: 2px;">Covariates</h4>                   
                </div>
                <div class='col-lg-1' style="padding: 0px">
                    <div class="row">
                        <div class='col-lg-6' style="padding: 0px">
                            <button class='btn btn-primary btn-sm pull-right'>Help</button>
                        </div>
                        <div class='col-lg-5' style="padding: 0px">
                            <button id="helpx" type="button" class="close" data-dismiss="modal">&times;</button>
                        </div>
                        <div class='col-lg-1' style="padding: 0px"></div>
                    </div>
                </div>
            </div>
            <div class="modal-body">
                <h5 style="margin-bottom: 2px">Instructions:</h5>
                <div style="font-size: 80%; margin-bottom: 2px"><i>Enter the covariates you would like to use in your analysis. All sites must have values for all covariates. Covariates can either be numeric or categorical. Choose if you would like to scale your numeric covariates. </i></div>    
                <br>
                <h5 style="margin-bottom: 2px">Site Covariates:</h5>
                <div style="font-size: 80%; margin-bottom: 2px"><i>Site covariates are covariates which are constant for all detections at a site. These covariates are used to model the site level effects.</i></div>
                <div class="row">
                    <div class="col-lg-9" style="padding-right: 0px">
                        <div id="siteCovariatesDiv" style="overflow-x: auto;"></div>
                    </div>
                    <div class="col-lg-3">
                        <div id="siteCovariatesExtraDiv"></div>
                    </div>
                </div>
                <button id="btnAddSiteCovariate" type="button" class="btn btn-primary btn-info" onclick="buildCovRow('site')">+</button>
                <br>    
                <br>
                <h5 style="margin-bottom: 2px">Detection Covariates:</h5>
                <div style="font-size: 80%; margin-bottom: 2px"><i>Detection covariates are covariates which are specific to each detection. These covariates are used to model the detection level effects.</i></div>
                <div class="row">
                    <div class="col-lg-9" style="padding-right: 0px;">
                        <div id="detectionCovariatesDiv" style="overflow-x: auto;"></div>
                    </div>
                    <div class="col-lg-3">
                        <div id="detectionCovariatesExtraDiv"></div>
                    </div>
                </div>
                <button id="btnAddDetCovariate" type='button' class='btn btn-primary btn-info' onclick="buildCovRow('det')">+</button>
                <br>
                <br>
                <div class="row">
                    <div class="col-lg-2">
                        <button id="importCovCSV" type='button' class='btn btn-primary btn-block' onclick="importCSV()">Import CSV</button>
                    </div>
                </div>
                <div id="covariatesError" style="font-size: 80%; color: #DF691A"></div>
            </div>
            <div class="modal-footer">
                <div class='col-lg-2'>
                    <button id="btnSaveCovariates" type='button' class='btn btn-primary btn-block' onclick="saveCovariates()">Save</button>
                </div>
                <div class='col-lg-2'>
                    <button id="btnCloseCovariates" type='button' class='btn btn-info btn-block' data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Covariates Import Modal -->
<div id="modalImportCovariates" class="modal fade" role="dialog" tabindex="-1"  style="overflow-y: auto;">
    <div class="modal-dialog" style="max-width: 40%;">
        <div class="modal-content">
            <div class="modal-header">
                <div class='col-lg-11' style="padding: 0px">
                    <h4 id= 'covariatesHeader' style="margin-bottom: 2px;">Import Covariates</h4>                   
                </div>
                <div class='col-lg-1' style="padding: 0px">
                    <div class="row">
                        <div class='col-lg-6' style="padding: 0px">
                            <button class='btn btn-primary btn-sm pull-right'>Help</button>
                        </div>
                        <div class='col-lg-5' style="padding: 0px">
                            <button id="helpx" type="button" class="close" data-dismiss="modal">&times;</button>
                        </div>
                        <div class='col-lg-1' style="padding: 0px"></div>
                    </div>
                </div>
            </div>
            <div class="modal-body">
                <h5 style="margin-bottom: 2px">Instructions:</h5>
                <div style="font-size: 80%; margin-bottom: 2px"><i> Upload a CSV file containing the covariates you would like to use in your analysis. Please note that your csv must contain a column with your site tags and columns for your site coordinates (latitude and longitude). Each covariate must be in its own column. </i></div>
                <br>

                <h5 style="margin-bottom: 2px">Upload CSV:</h5>
                <div class="row">
                    <div class="col-lg-8" style="padding-right: 0px">
                        <input type="file" id="covariatesFile" name="covariatesFile" accept=".csv">
                    </div>
                </div>
                <br>

                <h5 style="margin-bottom: 2px">Site</h5>
                <div style="font-size: 80%; margin-bottom: 2px"><i>Choose the column in your CSV file which contains the site names.</i></div>
                <div class="row">
                    <div class="col-lg-8">
                        <div class='row'>
                            <div class="col-lg-10">
                                <select id="siteCol" class="form-control"></select>
                            </div>
                        </div>
                    </div>
                </div>  
                <br>

                <h5 style="margin-bottom: 2px">Latitude</h5>
                <div style="font-size: 80%; margin-bottom: 2px"><i>Choose the column in your CSV file which contains the site latitude.</i></div>
                <div class="row">
                    <div class="col-lg-8">
                        <div class='row'>
                            <div class="col-lg-10">
                                <select id="latCol" class="form-control"></select>
                            </div>
                        </div>
                    </div>
                </div>
                <br>

                <h5 style="margin-bottom: 2px">Longitude</h5>
                <div style="font-size: 80%; margin-bottom: 2px"><i>Choose the column in your CSV file which contains the site longitude.</i></div>
                <div class="row">
                    <div class="col-lg-8">
                        <div class='row'>
                            <div class="col-lg-10">
                                <select id="longCol" class="form-control"></select>
                            </div>
                        </div>
                    </div>
                </div>
                <br>

                <h5 style="margin-bottom: 2px">Site Covariates</h5>
                <div style="font-size: 80%; margin-bottom: 2px"><i>Choose the columns in your CSV file which contain the site covariates.</i></div>
                <div class="row">
                    <div class="col-lg-8">
                        <div id="siteCovColsDiv"></div>
                        <button id="btnAddSiteCovCol" type="button" class="btn btn-primary btn-info" onclick="addSiteCovCol()">+</button>
                    </div>
                </div>
                <br>

                <h5 style="margin-bottom: 2px">Detection Covariates</h5>
                <div style="font-size: 80%; margin-bottom: 2px"><i>Choose the columns in your CSV file which contain the detection covariates.</i></div>
                <div class="row">
                    <div class="col-lg-8">
                        <div id="detCovColsDiv"></div>
                        <button id="btnAddDetCovCol" type="button" class="btn btn-primary btn-info" onclick="addDetCovCol()">+</button>
                    </div>
                </div>
                <br>

                <div id="covariatesImportError" style="font-size: 80%; color: #DF691A"></div>
            </div>
            <div class="modal-footer">
                <div class='col-lg-2'>
                    <button id="btnImportCovariates" type='button' class='btn btn-primary btn-block' onclick="importCovariates()">Import</button>
                </div>
                <div class='col-lg-2'>
                    <button id="btnCloseImportCovariates" type='button' class='btn btn-info btn-block' data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- <div id="modalAnnotationsSets" class="modal fade" role="dialog" tabindex="-1">
    <div class="modal-dialog" style="max-width: 40%;">
  
        <div class="modal-content">
            <div class="modal-header">
                  <div class='col-lg-11' style="padding: 0px">
                      <h4 id= 'groupHeader' style="margin-bottom: 2px;">Manage Annotation Sets for Results</h4>                   
                  </div>
                <div class='col-lg-1' style="padding: 0px">
                    <div class="row">
                        <div class='col-lg-6' style="padding: 0px">
                            <button class='btn btn-primary btn-sm pull-right'>Help</button>
                        </div>
                        <div class='col-lg-5' style="padding: 0px">
                            <button id="helpx" type="button" class="close" data-dismiss="modal">&times;</button>
                        </div>
                        <div class='col-lg-1' style="padding: 0px"></div>
                    </div>
                </div>
            </div>
            <div class="modal-body">
                <div id="annotationSetDiv">
                    <h5 style="margin-bottom: 2px">Surveys and Annotation Sets</h5>
                    <div style="font-size: 80%; margin-bottom: 2px"><i>Select which annotation set should be used for you results for surveys which have multiple annotation sets.</i></div>
                    <div class="row">
                        <div class="col-lg-6">Surveys</div>
                        <div class="col-lg-6">Annotation Sets</div>
                    </div>
                    <div id="annotationDiv"></div>
                    <div id="annotationSetErrors" style="font-size: 80%; color: #DF691A"></div>
                </div>
            </div>
            <div class='modal-footer'>
                <div class='col-lg-2'>
                    <button id="btnSaveSets" type='button' class='btn btn-primary btn-block'>Save</button>
                </div>
                <div class='col-lg-2'>
                    <button id="groupsClose" type='button' class='btn btn-info btn-block' 
                    data-dismiss='modal'>Close</button>
                </div>
            </div>
        </div>
    </div>
</div> -->

{% endblock %}

{% block page_scripts %}
<script src="js/camtrap.admin.commons.v{{ version }}.js"></script>
<script src="js/camtrap.results.v{{ version }}.js"></script>
<script src="js/camtrap.statistics.common.v{{ version }}.js"></script>
<script src="js/camtrap.groups.v{{ version }}.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
   integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
   crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
   integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
   crossorigin=""></script>
<script src="js/heatmap.min.js"></script>
<script src="js/leaflet-heatmap.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBHroBUjHugf-jw0m2Ajd5zYVcOMBegpUQ" defer></script>
<script src='https://unpkg.com/leaflet.gridlayer.googlemutant@latest/dist/Leaflet.GoogleMutant.js'></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
<script src="https://unpkg.com/@mapbox/leaflet-pip@latest/leaflet-pip.js"></script>
<link rel="stylesheet" href="js/Leaflet.BigImage.css">
<script src="js/Leaflet.BigImage.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/regression/2.0.1/regression.js"></script>
<!-- <script src="https://cdn.plot.ly/plotly-2.24.1.min.js" charset="utf-8"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.24.1/plotly.min.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/1.0.11/jquery.csv.min.js"></script>
{% endblock %}